<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AmFam Fit World â€” Level Quest (LocalStorage)</title>
  <style>
    :root{
      /* American Family Fitness inspired palette (not official marks) */
      --amfam-red:#e11d2b; 
      --amfam-blue:#0054a6; 
      --ink:#0f172a; 
      --muted:#64748b; 
      --paper:#f8fafc; 
      --card:#ffffff; 
      --track:#e2e8f0;
      --ring:rgba(0,84,166,.25);
    }
    *{box-sizing:border-box}
    body{margin:0;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;color:var(--ink);background:linear-gradient(180deg,#f0f4ff 0,#ffffff 40%)}
    .wrap{max-width:980px;margin:20px auto;padding:16px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    h1{margin:0;font-size:clamp(1.3rem,1.1rem+1.5vw,2.1rem);font-weight:900;letter-spacing:.2px}
    .brand{display:flex;align-items:center;gap:10px}
    .brand .badge{background:linear-gradient(90deg,var(--amfam-blue),var(--amfam-red));color:#fff;padding:.25rem .6rem;border-radius:999px;font-weight:800;font-size:.85rem}
    .sub{color:var(--muted)}
    .controls{display:flex;gap:8px;flex-wrap:wrap}
    button{appearance:none;border:2px solid var(--amfam-blue);background:#fff;color:var(--amfam-blue);padding:.6rem .85rem;border-radius:12px;cursor:pointer;font-weight:800;transition:.15s ease;box-shadow:0 2px 0 var(--amfam-blue)}
    button:hover{transform:translateY(-1px)}
    .btn-primary{background:linear-gradient(135deg,var(--amfam-blue),#3b82f6);color:#fff;border:none;box-shadow:none}
    .btn-reset{background:linear-gradient(135deg,#ef4444,#f97316);color:#fff;border:none;box-shadow:none}

    .board{margin-top:14px;background:var(--paper);border:1px solid var(--track);border-radius:18px;padding:14px;box-shadow:0 12px 40px rgba(2,6,23,.08)}

    /* MAP */
    .map{position:relative;aspect-ratio: 16/9;min-height:420px;border-radius:16px;background:radial-gradient(800px 300px at 20% 10%,#e8f0ff 0,#f5f7fb 50%,#ffffff 100%)}
    .map .decor{position:absolute;inset:0;pointer-events:none}
    .map svg#path{position:absolute;inset:0}
    .node{position:absolute;translate:-50% -50%;width:120px;max-width:28vw}
    .node card{display:block}
    .card{background:var(--card);border:1px solid var(--track);border-radius:14px;padding:10px 10px 10px 12px;box-shadow:0 6px 18px rgba(2,6,23,.06);display:flex;gap:8px;align-items:flex-start}
    .card h3{margin:0;font-size:.98rem}
    .card p{margin:3px 0 8px 0;font-size:.85rem;color:var(--muted)}
    .icon{width:34px;height:34px;border-radius:10px;background:linear-gradient(135deg,var(--amfam-blue),var(--amfam-red));display:grid;place-items:center;color:#fff;font-weight:900}
    .meta{display:flex;gap:6px;align-items:center;font-size:.8rem}
    .pill{border:1px solid var(--track);border-radius:999px;padding:.1rem .45rem;color:#0f172a;background:#f8fafc}
    .start{position:absolute;left:6%;top:84%}
    .n2{left:18%;top:62%}
    .n3{left:33%;top:70%}
    .n4{left:44%;top:54%}
    .n5{left:58%;top:66%}
    .n6{left:68%;top:48%}
    .n7{left:78%;top:58%}
    .n8{left:86%;top:42%}
    .n9{left:68%;top:28%}
    .n10{left:50%;top:18%}

    .avatar{position:absolute;width:22px;height:22px;border:2px solid #fff;background:linear-gradient(135deg,var(--amfam-red),var(--amfam-blue));border-radius:50%;box-shadow:0 0 0 3px rgba(0,84,166,.25);transform:translate(-50%,-50%)}

    /* Progress */
    .stats{display:flex;align-items:center;gap:12px;flex-wrap:wrap;margin:12px 0 4px}
    .stat{background:#fff;border:1px solid var(--track);padding:.5rem .75rem;border-radius:12px;font-weight:800}
    .progress{--p:0%;position:relative;height:12px;background:#eef2ff;border:1px solid #c7d2fe;border-radius:999px;overflow:hidden;flex:1}
    .progress>i{position:absolute;inset:0;width:var(--p);background:linear-gradient(90deg,var(--amfam-blue),var(--amfam-red))}

    /* State */
    .node.locked{filter:grayscale(.9) opacity(.7)}
    .node.completed .card{outline:2px solid #10b981}
    .node .do{width:100%;margin-top:6px;border-radius:10px}

    /* Confetti (CSS only, lightweight) */
    .confetti{position:absolute;inset:0;pointer-events:none}
    .spark{position:absolute;width:6px;height:10px;border-radius:2px;animation:pop .8s ease-out forwards}
    @keyframes pop{0%{transform:translate(0,0) rotate(0)}100%{transform:translate(var(--dx),var(--dy)) rotate(200deg);opacity:0}}

    .hint{color:var(--muted);font-size:.9rem}
  </style>
</head>
<body>
  <div class="wrap" role="application" aria-label="AmFam Fit World">
    <header>
      <div class="brand">
        <h1>AmFam Fit World â€” Level Quest</h1>
        <span class="badge">Virtual Gym</span>
      </div>
      <div class="controls" role="toolbar" aria-label="Controls">
        <button id="btn-submit" class="btn-primary" title="Open prefilled form in a new tab">Submit Progress</button>
        <button id="btn-reset" class="btn-reset" title="Reset local progress">Reset</button>
      </div>
    </header>
    <p class="sub">Progress through a virtual American Family Fitnessâ€“inspired world. Complete each level's challenge to unlock the next â€” no login, saved locally.</p>

    <section class="board">
      <div class="stats" aria-live="polite">
        <div class="stat">Level: <span id="level">1</span>/<span id="levelMax">10</span></div>
        <div class="stat">Completed: <span id="completed">0</span></div>
        <div class="progress" aria-label="Quest completion"><i id="bar"></i></div>
      </div>
      <div class="map" id="map">
        <svg id="path" viewBox="0 0 100 100" preserveAspectRatio="none" aria-hidden="true">
          <path id="trail" d="M5,90 C20,70 30,75 40,60 S60,55 70,40 85,35 92,45 78,30 68,18 50,12 45,10" fill="none" stroke="#8db3ff" stroke-width="1.5" stroke-dasharray="2 2" />
        </svg>
        <div class="avatar" id="avatar" title="Your marker"></div>

        <!-- Level nodes -->
        <div class="node start" data-i="0">
          <div class="card">
            <div class="icon">ğŸ</div>
            <div>
              <h3>Level 1 â€” Check In</h3>
              <p>Visit the club or check in on the app.</p>
              <div class="meta"><span class="pill">Facility</span><span class="pill">Warmup</span></div>
              <button class="do">Complete</button>
            </div>
          </div>
        </div>
        <div class="node n2" data-i="1">
          <div class="card"><div class="icon">ğŸ‹ï¸</div><div><h3>Level 2 â€” Strength</h3><p>Do a basic strength session (20 min).</p><div class="meta"><span class="pill">Weights</span></div><button class="do">Complete</button></div></div>
        </div>
        <div class="node n3" data-i="2">
          <div class="card"><div class="icon">ğŸš´</div><div><h3>Level 3 â€” Cardio</h3><p>Cycle, run, or row for 15 min.</p><div class="meta"><span class="pill">Cardio</span></div><button class="do">Complete</button></div></div>
        </div>
        <div class="node n4" data-i="3">
          <div class="card"><div class="icon">ğŸ’§</div><div><h3>Level 4 â€” Hydrate</h3><p>Drink 2 bottles of water today.</p><div class="meta"><span class="pill">Health</span></div><button class="do">Complete</button></div></div>
        </div>
        <div class="node n5" data-i="4">
          <div class="card"><div class="icon">ğŸ¤¸</div><div><h3>Level 5 â€” Mobility</h3><p>Stretch or foam roll 10 min.</p><div class="meta"><span class="pill">Recovery</span></div><button class="do">Complete</button></div></div>
        </div>
        <div class="node n6" data-i="5">
          <div class="card"><div class="icon">ğŸ‘¥</div><div><h3>Level 6 â€” Group Fitness</h3><p>Attend a class (e.g., HIIT, Yoga).</p><div class="meta"><span class="pill">Community</span></div><button class="do">Complete</button></div></div>
        </div>
        <div class="node n7" data-i="6">
          <div class="card"><div class="icon">ğŸŠ</div><div><h3>Level 7 â€” Pool</h3><p>Swim or water-walk 10 lengths.</p><div class="meta"><span class="pill">Aquatics</span></div><button class="do">Complete</button></div></div>
        </div>
        <div class="node n8" data-i="7">
          <div class="card"><div class="icon">ğŸ®</div><div><h3>Level 8 â€” Virtuagym</h3><p>Complete 1 guided inâ€‘app workout.</p><div class="meta"><span class="pill">App</span></div><button class="do">Complete</button></div></div>
        </div>
        <div class="node n9" data-i="8">
          <div class="card"><div class="icon">ğŸ¥—</div><div><h3>Level 9 â€” Fuel</h3><p>Log a balanced meal today.</p><div class="meta"><span class="pill">Nutrition</span></div><button class="do">Complete</button></div></div>
        </div>
        <div class="node n10" data-i="9">
          <div class="card"><div class="icon">ğŸ†</div><div><h3>Level 10 â€” Finale</h3><p>Share your success photo or checkâ€‘in.</p><div class="meta"><span class="pill">Celebrate</span></div><button class="do">Complete</button></div></div>
        </div>

        <div class="confetti" id="confetti"></div>
      </div>
      <p class="hint">Tip: Levels unlock sequentially. Your progress is saved on this device only (localStorage). â€œSubmit Progressâ€ can prefill a Google Form for the club.</p>
    </section>
  </div>

<script>
// ========== CONFIG ==========
const BOARD_KEY = 'amfam.fitworld.levels.v1';
const FORM_BASE = 'https://docs.google.com/forms/d/e/FORM_ID/viewform'; // TODO replace
const ENTRY_MAP = { level:'entry.100', completed:'entry.101', name:'entry.102' };

const LEVELS = [
  { title:'Level 1 â€” Check In', blurb:'Visit the club or check in on the app.', tags:['Facility','Warmup'], key:'checkin'},
  { title:'Level 2 â€” Strength', blurb:'Do a basic strength session (20 min).', tags:['Weights'], key:'strength'},
  { title:'Level 3 â€” Cardio', blurb:'Cycle, run, or row for 15 min.', tags:['Cardio'], key:'cardio'},
  { title:'Level 4 â€” Hydrate', blurb:'Drink 2 bottles of water today.', tags:['Health'], key:'hydration'},
  { title:'Level 5 â€” Mobility', blurb:'Stretch or foam roll 10 min.', tags:['Recovery'], key:'mobility'},
  { title:'Level 6 â€” Group Fitness', blurb:'Attend a class (e.g., HIIT, Yoga).', tags:['Community'], key:'class'},
  { title:'Level 7 â€” Pool', blurb:'Swim or water-walk 10 lengths.', tags:['Aquatics'], key:'pool'},
  { title:'Level 8 â€” Virtuagym', blurb:'Complete 1 guided inâ€‘app workout.', tags:['App'], key:'virtuagym'},
  { title:'Level 9 â€” Fuel', blurb:'Log a balanced meal today.', tags:['Nutrition'], key:'nutrition'},
  { title:'Level 10 â€” Finale', blurb:'Share your success photo or checkâ€‘in.', tags:['Celebrate'], key:'finale'}
];

// ========== STATE ==========
const defaultState = () => ({ idx:0, // highest unlocked index (0-based)
  completed: Array(LEVELS.length).fill(false), name: localStorage.getItem('fitworld.name') || '' });
function load(){ try { return JSON.parse(localStorage.getItem(BOARD_KEY)) ?? defaultState(); } catch { return defaultState(); } }
function save(s){ localStorage.setItem(BOARD_KEY, JSON.stringify(s)); }
let state = load();

// ========== DOM ==========
const $ = (s)=>document.querySelector(s);
const nodes = [...document.querySelectorAll('.node')];
const levelEl = $('#level');
const levelMaxEl = $('#levelMax');
const completedEl = $('#completed');
const barEl = $('#bar');
const avatar = $('#avatar');
const trail = document.getElementById('trail');
const confetti = $('#confetti');
levelMaxEl.textContent = LEVELS.length;

// ========== RENDER ==========
function render(){
  // lock/unlock nodes
  nodes.forEach(n => n.classList.add('locked'));
  for(let i=0;i<=state.idx;i++){ nodes[i]?.classList.remove('locked'); }
  // completed state
  nodes.forEach((n,i)=> n.classList.toggle('completed', !!state.completed[i]));

  // wire buttons
  nodes.forEach((n,i)=>{
    const btn = n.querySelector('.do');
    btn.disabled = i>state.idx || state.completed[i];
    btn.textContent = state.completed[i] ? 'Completed' : (i>state.idx ? 'Locked' : 'Complete');
    btn.onclick = ()=> completeLevel(i);
  });

  const doneCount = state.completed.filter(Boolean).length;
  completedEl.textContent = doneCount;
  levelEl.textContent = Math.min(doneCount+1, LEVELS.length);
  barEl.style.setProperty('--p', `${Math.round((doneCount/LEVELS.length)*100)}%`);

  moveAvatar();
}

function moveAvatar(){
  const done = state.completed.filter(Boolean).length;
  const t = Math.max(0, Math.min(1, done/LEVELS.length));
  const len = trail.getTotalLength();
  const pt = trail.getPointAtLength(len * t);
  const svg = document.getElementById('path');
  const r = svg.getBoundingClientRect();
  avatar.style.left = (pt.x/100 * r.width) + 'px';
  avatar.style.top  = (pt.y/100 * r.height) + 'px';
}

function burstConfetti(x,y){
  for(let i=0;i<24;i++){
    const s = document.createElement('div');
    s.className='spark';
    s.style.left = x+'px'; s.style.top = y+'px';
    s.style.background = i%2? 'var(--amfam-blue)' : 'var(--amfam-red)';
    const dx = (Math.random()*160-80)+'px';
    const dy = (Math.random()*-160)+'px';
    s.style.setProperty('--dx', dx); s.style.setProperty('--dy', dy);
    confetti.appendChild(s);
    setTimeout(()=> s.remove(), 900);
  }
}

function completeLevel(i){
  if(i>state.idx) return; // locked
  if(state.completed[i]) return; // already
  state.completed[i] = true;
  // unlock next
  if(state.idx < LEVELS.length-1) state.idx = Math.max(state.idx, i+1);
  save(state);
  render();
  // celebrate at the node's position
  const rect = nodes[i].getBoundingClientRect();
  const parent = document.getElementById('map').getBoundingClientRect();
  burstConfetti(rect.left-parent.left+60, rect.top-parent.top+20);
}

// Submit (optional Google Form)
function buildFormUrl(){
  const params = new URLSearchParams();
  params.set(ENTRY_MAP.level, String(state.idx+1));
  params.set(ENTRY_MAP.completed, state.completed.map(v=>v?1:0).join(','));
  const who = prompt('Enter your name or member ID (optional):', state.name || '');
  if(who!==null){ state.name = who; localStorage.setItem('fitworld.name', who); save(state); params.set(ENTRY_MAP.name, who); }
  return `${FORM_BASE}?${params.toString()}`;
}

document.getElementById('btn-submit').addEventListener('click', ()=>{
  const url = buildFormUrl(); window.open(url,'_blank','noopener');
});

document.getElementById('btn-reset').addEventListener('click', ()=>{
  if(confirm('Reset local progress? This only affects this device.')){ state = defaultState(); save(state); render(); }
});

// ========== INIT ==========
render();
window.addEventListener('resize', moveAvatar);
</script>
</body>
</html>
